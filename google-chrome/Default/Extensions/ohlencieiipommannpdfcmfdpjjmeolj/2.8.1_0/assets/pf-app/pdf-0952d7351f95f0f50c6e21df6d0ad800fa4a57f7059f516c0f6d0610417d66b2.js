var messageBus=function(){var e=!1;return{postMessage:function(e,t,o){"root"===e?chrome.tabs.sendMessage(window.extensionRootTabId,{type:t,payload:o}):chrome.runtime.sendMessage({type:t,payload:o})},listen:function(t,o){e||(chrome.runtime.onMessage.addListener(function(e){try{if(!e)return;var r=e.type;if(!r)return;var n=t[r];if(!n)return;n(e.payload)}catch(e){if(!o)throw e;o(e)}}),e=!0)}}}(),analytics=function(){return{sendEvent:function(e,t,o){messageBus.postMessage("core","PfGaEvent",{category:e,action:t,label:o})}}}(),Pdf={REPORT_PDF_ERROR:!1,init:function(){this.configure(),this.poll()},configure:function(){this.data={id:PDFSettings.id,start_time:startTime}},poll:function(){Pdf.pollStart||(Pdf.pollStart=new Date),(new Date-Pdf.pollStart)/1e3>40?Pdf.showError("timeout"):Pdf.makeRequest()},makeRequest:function(){jQuery.ajax({data:Pdf.data,dataType:"json",type:"get",url:"/pdfs/poll.js",timeout:3e3,cache:!1,error:function(e,t,o){"timeout"===t?window.setTimeout(Pdf.poll,1e3):(Pdf.REPORT_PDF_ERROR&&Pdf.reportPdfError(e,t,o),Pdf.showError())},success:function(e){"initialized"===e.state?window.setTimeout(Pdf.poll,300):"complete"===e.state&&(messageBus.postMessage("core","PfPdfOkEvent"),Pdf.showDownloadButton(e.url))}})},reportPdfError:function(e,t,o){if(0===window.location.protocol.indexOf("http")){var r="";e.responseJSON&&e.responseJSON.errorType&&(r=e.responseJSON.errorType);var n="s: "+e.status+" | ts: "+t+" | msg: "+o+" | se: "+r;try{Raven.captureException(new Error("pdfError"),{extra:{message:n}})}catch(e){}}},showDownloadButton:function(e){$("a.js-pdf-download").attr("href",e),$(".js-pdf-download").removeClass("disabled")},showError:function(){$("#pf-dialog-pdf").html("<b>Sorry. An error occurred. Please try again.</b>")}};analytics.setCoreWindow(window.parent),$(document).on("change","#page-size",function(){var e=$(this).val();$("#alternate-page-size input[name=page-size]").val(e),$("#alternate-page-size").submit()});